<template>

    <div class="relative">

        <div class="fixed top-4 left-4 rounded border border-gray-400 dark:border-gray-600 dark:bg-black px-2 flex space-x-2 items-center">
            <div class="rounded-full w-2 h-2 shrink-0" :class="online ? 'bg-green-500' : 'bg-red-500'" />
            <div>{{ online ? 'Online' : 'Offline' }}</div>
        </div>

        <!-- Dark Mode Toggle -->
        <div class="absolute top-4 right-4 z-20">
            <button @click="darkMode.enabled = !darkMode.enabled"
                class="p-2 rounded-full bg-white dark:bg-indigo-950/80 shadow-md hover:shadow-lg transition-all">
                <svg v-if="darkMode.enabled" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
        </div>

        <div class="pt-16 lg:pt-32 flex items-center justify-center w-full">

            <div class="w-full max-2xl py-16 md:py-32 text-center flex flex-col items-center px-8 md:px-16">
                <div class="text-9xl pb-8">ðŸ¥­</div>
                <h1 class="font-bold text-5xl pb-4 bg-clip-text bg-gradient-to-r from-orange-500 to-green-500 text-transparent">Welcome to Mango</h1>
                <h1 class="font-bold text-lg bg-clip-text bg-gradient-to-r from-orange-500 to-green-500 text-transparent italic opacity-50">Here to make your life easier.</h1>
            </div>

        </div>

        <div v-if="!store.user?.id || !online" class="flex w-full justify-center">
            <login v-if="online" class="max-w-md" />
            <div v-else class="space-y-8">
                <div class="text-lg">Looks like the local Mango server isn't up and running yet. Please start it by running:</div>
                <div class="w-full">
                    <div class="flex items-center space-x-2 relative">
                        <code class="bg-gray-200 dark:bg-black p-3 border border-gray-700 rounded-lg flex-grow dark:selection:bg-sky-700">yarn mango dev</code>
                        <button @click="copyToClipboard('yarn mango dev')" class="p-2 rounded-lg bg-gray-200 dark:bg-black border border-gray-700 hover:bg-gray-300 dark:hover:bg-gray-800 transition-colors relative group">
                            <svg v-if="!copied" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap opacity-0 transition-opacity duration-300" :class="{ 'opacity-100': copied }">
                                Copied!
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="store.user?.id" class="w-full flex flex-col p-4 items-center space-y-4">

            <div class="w-full max-w-xl">
                <div class="text mb-4">Great! Now you're logged in as:</div>
                    <div class="text-2xl mb-8">{{ store.user.title }}</div>
                <div class="rounded-lg bg-gray-100 dark:bg-gray-800 p-4 ">
                    <pre class="tracking-widest opacity-75 font-mono mt-2 truncate text-xs" v-html="JSON.stringify(store.user, undefined, 4).replaceAll('\n', '<br>').replaceAll(' ', '&nbsp;')" />
                </div>
            </div>

            <!-- <Mango collection="members" v-slot="{data, loading}" >
                <div v-if="data">
                    <div v-for="member in data">{{ member.title }}</div>
                </div>
            </Mango> -->

        </div>
    </div>

</template>

<script>
import Login from '../layout/login.vue'

export default {
    components: { Login },
    inject: ['store','darkMode'],
    methods: {
        async copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                this.copied = true;
                setTimeout(() => {
                    this.copied = false;
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text:', err);
            }
        },
    },
    data() {
        return {
            online: false,
            checker: null,
            copied: false,
        }
    },
    async created() {
        this.online = await this.$mango.online()
        this.checker = setInterval(async () => {
            this.online = await this.$mango.online()
        }, 500);
    },
    beforeDestroy() {
        clearInterval(this.checker)
    }
}
</script>
